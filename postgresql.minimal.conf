# PostgreSQL minimal configuration for 2GB VPS
# Optimized for Malaysian Loan Bot single client setup

# Memory Settings (Conservative for 2GB VPS)
shared_buffers = 64MB                    # 25% of allocated 200MB container memory
effective_cache_size = 128MB             # Estimate of OS cache available
work_mem = 2MB                          # Memory for sorts and hash joins
maintenance_work_mem = 32MB             # Memory for maintenance operations

# Connection Settings
max_connections = 20                    # Minimal connections for single client
superuser_reserved_connections = 2

# Write Ahead Logging (WAL)
wal_level = replica                     # Minimal WAL level
max_wal_size = 64MB                     # Small WAL size
min_wal_size = 16MB

# Checkpoint Settings
checkpoint_completion_target = 0.9
checkpoint_timeout = 10min

# Query Planning
random_page_cost = 1.1                  # Assume SSD storage
effective_io_concurrency = 200          # For SSD

# Logging (Minimal for production)
log_destination = 'stderr'
logging_collector = off
log_min_messages = warning
log_min_error_statement = error
log_duration = off
log_statement = 'none'

# Background Writer
bgwriter_delay = 200ms
bgwriter_lru_maxpages = 100
bgwriter_lru_multiplier = 2.0

# Autovacuum (Essential but conservative)
autovacuum = on
autovacuum_max_workers = 1
autovacuum_vacuum_threshold = 50
autovacuum_analyze_threshold = 50
autovacuum_vacuum_scale_factor = 0.2
autovacuum_analyze_scale_factor = 0.1

# Locale Settings
lc_messages = 'en_US.utf8'
lc_monetary = 'en_US.utf8'
lc_numeric = 'en_US.utf8'
lc_time = 'en_US.utf8'

# Default text search config
default_text_search_config = 'pg_catalog.english'

# Timezone
timezone = 'UTC'

# Performance optimizations for small datasets
seq_page_cost = 1.0
random_page_cost = 1.1
cpu_tuple_cost = 0.01
cpu_index_tuple_cost = 0.005
cpu_operator_cost = 0.0025

# Memory-conscious settings
temp_buffers = 8MB
max_prepared_transactions = 0           # Disable if not using 2PC
max_locks_per_transaction = 64
max_pred_locks_per_transaction = 64

# Archive settings (disabled for minimal setup)
archive_mode = off

# Statistics
track_activities = on
track_counts = on
track_io_timing = off                   # Disable to save CPU
track_functions = none